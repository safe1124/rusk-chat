<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API í…ŒìŠ¤íŠ¸ ë„êµ¬</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        .test-section { 
            margin: 20px 0; 
            padding: 20px; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
        }
        button { 
            padding: 10px 20px; 
            margin: 5px; 
            border: none; 
            border-radius: 4px; 
            background: #007bff; 
            color: white; 
            cursor: pointer; 
        }
        button:hover { background: #0056b3; }
        .result { 
            margin-top: 10px; 
            padding: 10px; 
            background: #f8f9fa; 
            border-radius: 4px; 
            white-space: pre-wrap; 
        }
        .error { background: #f8d7da; color: #721c24; }
        .success { background: #d4edda; color: #155724; }
    </style>
</head>
<body>
    <h1>ğŸ§ª Rusk Chat API í…ŒìŠ¤íŠ¸ ë„êµ¬</h1>
    
    <div class="test-section">
        <h2>1. í™˜ê²½ ì„¤ì • í™•ì¸</h2>
        <button onclick="checkEnvironment()">í™˜ê²½ í™•ì¸</button>
        <div id="envResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>2. API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testApiEndpoint()">ê¸°ë³¸ ì—°ê²° í…ŒìŠ¤íŠ¸</button>
        <button onclick="testWithSimpleMessage()">ê°„ë‹¨í•œ ë©”ì‹œì§€ í…ŒìŠ¤íŠ¸</button>
        <button onclick="testWithFullMessage()">ì „ì²´ ë©”ì‹œì§€ í…ŒìŠ¤íŠ¸</button>
        <div id="apiResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>4. CORS ìš°íšŒ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testWithProxy()">í”„ë¡ì‹œ í…ŒìŠ¤íŠ¸</button>
        <button onclick="testDirectConnection()">ì§ì ‘ ì—°ê²° í…ŒìŠ¤íŠ¸</button>
        <div id="corsResult" class="result"></div>
    </div>

    <div class="test-section">
        <h2>3. ë„¤íŠ¸ì›Œí¬ ìƒíƒœ</h2>
        <button onclick="checkNetworkStatus()">ë„¤íŠ¸ì›Œí¬ ìƒíƒœ í™•ì¸</button>
        <div id="networkResult" class="result"></div>
    </div>

    <script>
        const BACKEND_URL = 'https://rusk-chat-pitut7wwv-3minute.vercel.app';
        
        function log(elementId, message, type = '') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = 'result ' + type;
            console.log(message);
        }
        
        async function checkEnvironment() {
            log('envResult', 'í™˜ê²½ í™•ì¸ ì¤‘...', '');
            
            const info = {
                userAgent: navigator.userAgent,
                location: window.location.href,
                backend: BACKEND_URL,
                timestamp: new Date().toISOString()
            };
            
            log('envResult', JSON.stringify(info, null, 2), 'success');
        }
        
        async function testApiEndpoint() {
            log('apiResult', 'API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸ ì¤‘...', '');
            
            try {
                // ë¨¼ì € GET ìš”ì²­ìœ¼ë¡œ ê°„ë‹¨íˆ í…ŒìŠ¤íŠ¸
                const getResponse = await fetch(`${BACKEND_URL}/api/chat`, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                const getResult = {
                    status: getResponse.status,
                    statusText: getResponse.statusText,
                    ok: getResponse.ok
                };
                
                if (getResponse.ok) {
                    const data = await getResponse.json();
                    log('apiResult', `âœ… GET ìš”ì²­ ì„±ê³µ:\nStatus: ${getResult.status}\nResponse: ${JSON.stringify(data, null, 2)}`, 'success');
                } else {
                    const errorText = await getResponse.text();
                    log('apiResult', `âŒ GET ìš”ì²­ ì‹¤íŒ¨:\nStatus: ${getResult.status}\nError: ${errorText}`, 'error');
                }
                
            } catch (error) {
                log('apiResult', `âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}\n\nê°€ëŠ¥í•œ ì›ì¸:\n1. CORS ì •ì±… ìœ„ë°˜\n2. ë„¤íŠ¸ì›Œí¬ ì—°ê²° ë¬¸ì œ\n3. ì„œë²„ ì˜¤ë¥˜`, 'error');
            }
        }
        
        async function testWithSimpleMessage() {
            log('apiResult', 'ê°„ë‹¨í•œ ë©”ì‹œì§€ í…ŒìŠ¤íŠ¸ ì¤‘...', '');
            
            try {
                const requestData = {
                    messages: [
                        { role: 'user', content: 'Hello' }
                    ],
                    character: 'ãƒ©ã‚¹ã‚¯'
                };
                
                console.log('ìš”ì²­ ë°ì´í„°:', requestData);
                
                const response = await fetch(`${BACKEND_URL}/api/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                console.log('ì‘ë‹µ ìƒíƒœ:', response.status, response.statusText);
                
                const responseText = await response.text();
                console.log('ì‘ë‹µ ì›ë¬¸:', responseText);
                
                if (response.ok) {
                    try {
                        const data = JSON.parse(responseText);
                        log('apiResult', `âœ… ì„±ê³µ!\nì‘ë‹µ: ${JSON.stringify(data, null, 2)}`, 'success');
                    } catch (e) {
                        log('apiResult', `âš ï¸ JSON íŒŒì‹± ì‹¤íŒ¨\nì›ë¬¸: ${responseText}`, 'error');
                    }
                } else {
                    log('apiResult', `âŒ ì‹¤íŒ¨ (${response.status})\nì‘ë‹µ: ${responseText}`, 'error');
                }
                
            } catch (error) {
                log('apiResult', `âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }
        
        async function testWithFullMessage() {
            log('apiResult', 'ì „ì²´ ë©”ì‹œì§€ í…ŒìŠ¤íŠ¸ ì¤‘...', '');
            
            try {
                const requestData = {
                    messages: [
                        {
                            role: 'system',
                            content: 'ë‹¹ì‹ ì€ ë¼ìŠ¤í¬ë¼ëŠ” ì¹œê·¼í•œ AI ìºë¦­í„°ì…ë‹ˆë‹¤.'
                        },
                        {
                            role: 'user',
                            content: 'ì•ˆë…•í•˜ì„¸ìš”! ìê¸°ì†Œê°œ í•´ì£¼ì„¸ìš”.'
                        }
                    ],
                    character: 'ãƒ©ã‚¹ã‚¯'
                };
                
                const response = await fetch(`${BACKEND_URL}/api/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                const responseText = await response.text();
                
                if (response.ok) {
                    try {
                        const data = JSON.parse(responseText);
                        log('apiResult', `âœ… ì „ì²´ í…ŒìŠ¤íŠ¸ ì„±ê³µ!\në¼ìŠ¤í¬ ì‘ë‹µ: ${data.message}`, 'success');
                    } catch (e) {
                        log('apiResult', `âš ï¸ JSON íŒŒì‹± ì‹¤íŒ¨\nì›ë¬¸: ${responseText}`, 'error');
                    }
                } else {
                    log('apiResult', `âŒ ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ (${response.status})\nì‘ë‹µ: ${responseText}`, 'error');
                }
                
            } catch (error) {
                log('apiResult', `âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }
        
        
        async function testWithProxy() {
            log('corsResult', 'í”„ë¡ì‹œë¥¼ í†µí•œ í…ŒìŠ¤íŠ¸ ì¤‘...', '');
            
            try {
                // CORS í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•œ í…ŒìŠ¤íŠ¸
                const proxyUrl = `https://cors-anywhere.herokuapp.com/${BACKEND_URL}/api/chat`;
                
                const response = await fetch(proxyUrl, {
                    method: 'GET',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    log('corsResult', `âœ… í”„ë¡ì‹œ í…ŒìŠ¤íŠ¸ ì„±ê³µ:\n${JSON.stringify(data, null, 2)}`, 'success');
                } else {
                    const errorText = await response.text();
                    log('corsResult', `âŒ í”„ë¡ì‹œ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${errorText}`, 'error');
                }
                
            } catch (error) {
                log('corsResult', `âŒ í”„ë¡ì‹œ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }
        
        async function testDirectConnection() {
            log('corsResult', 'ì§ì ‘ ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...', '');
            
            try {
                // ì´ë¯¸ì§€ë¥¼ í†µí•œ ìš°íšŒ í…ŒìŠ¤íŠ¸
                const img = new Image();
                const testUrl = `${BACKEND_URL}/api/chat?test=ping&timestamp=${Date.now()}`;
                
                img.onload = () => {
                    log('corsResult', 'âœ… ì„œë²„ ì‘ë‹µ í™•ì¸ë¨ (ì´ë¯¸ì§€ ë¡œë“œ ì„±ê³µ)', 'success');
                };
                
                img.onerror = () => {
                    log('corsResult', 'âš ï¸ ì„œë²„ ì‘ë‹µì€ ìˆì§€ë§Œ ì´ë¯¸ì§€ê°€ ì•„ë‹˜ (ì •ìƒ)', 'success');
                };
                
                img.src = testUrl;
                
                // 5ì´ˆ í›„ íƒ€ì„ì•„ì›ƒ
                setTimeout(() => {
                    log('corsResult', 'ğŸ• ì§ì ‘ ì—°ê²° í…ŒìŠ¤íŠ¸ ì™„ë£Œ (ìœ„ ê²°ê³¼ ì°¸ì¡°)', '');
                }, 5000);
                
            } catch (error) {
                log('corsResult', `âŒ ì§ì ‘ ì—°ê²° ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }
        
        async function checkNetworkStatus() {
            log('networkResult', 'ë„¤íŠ¸ì›Œí¬ ìƒíƒœ í™•ì¸ ì¤‘...', '');
            
            const tests = [
                { name: 'Google', url: 'https://www.google.com' },
                { name: 'Vercel', url: 'https://vercel.com' },
                { name: 'Backend', url: BACKEND_URL }
            ];
            
            let results = [];
            
            for (const test of tests) {
                try {
                    const start = Date.now();
                    const response = await fetch(test.url, { method: 'HEAD', mode: 'no-cors' });
                    const time = Date.now() - start;
                    results.push(`âœ… ${test.name}: ${time}ms`);
                } catch (error) {
                    results.push(`âŒ ${test.name}: ${error.message}`);
                }
            }
            
            log('networkResult', results.join('\n'), 'success');
        }
    </script>
</body>
</html>
